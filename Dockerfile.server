FROM ubuntu:17.10

RUN apt-get update && \
        apt-get install -y python3-dev && \
        apt-get install -y python3-pip && \
        pip3 install flask && \
        apt-get install -y openssh-server && \
        ssh-keygen -A && \
        mkdir -p /run/sshd && \
        apt-get install -y git=1:2.14.1-1ubuntu4 && \
        git config --global user.email "test@ensimag.com" && \
        git config --global user.name "test"

RUN mkdir /root/.ssh
ADD key/id_rsa.pub /tmp/id_rsa.pub
RUN cat /tmp/id_rsa.pub >> /root/.ssh/authorized_keys && rm /tmp/id_rsa.pub

WORKDIR /root/home/

ADD poc poc/
ADD client.py poc/client.py

WORKDIR poc/
ADD server.py server.app
RUN ssh-keygen -t rsa -b 2048 -N "" -f /root/.ssh/id_rsa -q
RUN ./build.sh

EXPOSE 22
EXPOSE 1234

ENTRYPOINT /usr/sbin/sshd && python3 ./server.app